<div class="page-wrapper">
  <header class="page-header">
    <div>
      <h1>UOL GPA &amp; CGPA Calculator</h1>
      <p class="subtitle">
        University of Lahore – GPA &amp; weighted CGPA calculator based on the official grading
        policy.
      </p>
    </div>
  </header>

  <main class="grid">
    <div class="left-column">
      <!-- GPA: Course Entry -->
      <section class="card">
        <h2 title="GPA is the weighted average of your course grades in a single semester.">
          Semester GPA Calculator
        </h2>
        <p class="section-description">
          Add your courses for the current semester. GPA updates in real time so you can estimate
          your result before it is released.
        </p>

        <form [formGroup]="gpaForm" class="form-section" novalidate>
          <div class="table-header">
            <span>Course</span>
            <span>Credit Hours</span>
            <span>Grade</span>
            <span class="actions-col">Actions</span>
          </div>

          <div
            class="table-row"
            formArrayName="courses"
            *ngFor="let course of courses.controls; let i = index; trackBy: trackByIndex"
          >
            <div [formGroupName]="i" class="row-inner">
              <input
                type="text"
                formControlName="name"
                placeholder="Course name (optional)"
              />

              <select formControlName="creditHours">
                <option *ngFor="let ch of creditHourOptions" [value]="ch">
                  {{ ch }}
                </option>
              </select>

              <select formControlName="grade">
                <option *ngFor="let g of gradeOptions" [value]="g">
                  {{ g }}
                </option>
              </select>

              <button
                type="button"
                class="btn-text danger"
                (click)="removeCourse(i)"
              >
                Remove
              </button>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn primary"
              (click)="addCourse()"
              [disabled]="gpaForm.invalid"
            >
              + Add Course
            </button>
            <button
              type="button"
              class="btn ghost"
              (click)="resetCourses()"
              [disabled]="currentTotalCreditHours === 0 && courses.length === 1"
            >
              Reset courses
            </button>
          </div>

          <p class="helper-text">
            Tip: Use this to plan your academic load each semester and keep your GPA on target.
          </p>

          <div class="info-note">
            <strong>UOL Grading:</strong>
            A = 4.00, A- = 3.75, B+ = 3.50, B = 3.00, C+ = 2.50, C = 2.00,
            D+ = 1.50, D = 1.00, F = 0.00. Credit hours allowed: 1–4.
          </div>
        </form>
      </section>

      <!-- CGPA Calculator -->
      <section class="card cgpa-card">
      <div class="cgpa-header" title="CGPA is the weighted average of all your semesters combined.">
        <div>
          <h2>CGPA Calculator (Multi-Semester)</h2>
          <p class="section-description">
            Provide your GPA and total credit hours for each completed semester.
            CGPA is calculated using weighted credit hours (not simple average).
          </p>
        </div>
        <div class="cgpa-highlight">
          <span class="cgpa-label">CGPA</span>
          <span class="cgpa-value-big">
            {{ currentCgpa !== null ? (currentCgpa | number: '1.2-2') : '—' }}
          </span>
    </div>
      </div>

      <form [formGroup]="semestersForm" class="form-section" novalidate>
        <div class="table-header">
          <span>Semester</span>
          <span>Semester GPA</span>
          <span>Credit Hours</span>
          <span class="actions-col">Actions</span>
        </div>

        <div
          class="table-row"
          formArrayName="semesters"
          *ngFor="let sem of semesters.controls; let i = index; trackBy: trackByIndex"
        >
          <div [formGroupName]="i" class="row-inner">
            <input
              type="text"
              formControlName="name"
              placeholder="Semester name"
            />

            <input
              type="number"
              formControlName="gpa"
              min="0"
              max="4"
              step="0.01"
              placeholder="e.g. 3.45"
            />

            <input
              type="number"
              formControlName="creditHours"
              min="1"
              step="1"
              placeholder="e.g. 18"
            />

            <button
              type="button"
              class="btn-text danger"
              (click)="removeSemester(i)"
            >
              Remove
            </button>
      </div>
    </div>

        <div class="form-actions">
          <button
            type="button"
            class="btn secondary"
            (click)="addSemester()"
            [disabled]="semestersForm.invalid"
          >
            + Add Semester
          </button>
          <button
            type="button"
            class="btn ghost"
            (click)="resetSemesters()"
            [disabled]="currentTotalCgpaCredits === 0 && semesters.length === 1"
          >
            Reset semesters
          </button>
  </div>
      </form>

      <div class="cgpa-summary" *ngIf="currentCgpa !== null; else noCgpa">
        <div class="result-row">
          <span>Total Credit Hours (All Semesters)</span>
          <span class="result-value">
            {{ currentTotalCgpaCredits }}
          </span>
        </div>
        <div class="result-row">
          <span>CGPA</span>
          <span class="result-value">
            {{ currentCgpa | number: '1.2-2' }}
          </span>
        </div>
      </div>

      <ng-template #noCgpa>
        <p class="hint">
          Add at least one valid semester (GPA between 0.00 and 4.00, credit hours &gt; 0)
          to see your CGPA.
        </p>
      </ng-template>
      </section>
    </div>

    <!-- GPA Result -->
    <section class="card highlight gpa-result-card">
      <h2 title="Your semester GPA based on UOL's official grading policy.">
        Semester GPA Result
      </h2>
      <div class="result-row">
        <span>Total Credit Hours</span>
        <span class="result-value">
          {{ currentTotalCreditHours || 0 }}
        </span>
      </div>
      <div class="result-row">
        <span>GPA</span>
        <span class="result-value gpa-value" [class.result-pulse]="isGpaPulsing">
          {{ currentGpa | number: '1.2-2' }}
        </span>
      </div>
      <p class="hint">
        If you have no courses, GPA is defined as 0.00.
      </p>
      <p class="helper-text">
        Students often use this to double-check manual GPA calculations before submitting forms.
      </p>
    </section>

  </main>

  <footer class="page-footer">
    <span>UOL GPA &amp; CGPA Calculator – University of Lahore</span>
  </footer>
</div>
